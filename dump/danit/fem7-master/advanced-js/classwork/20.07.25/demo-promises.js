// https://medium.com/@ankitkamboj18/is-javascript-synchronous-or-asynchronous-what-the-hell-is-a-promise-302ee008dfcd
/* –¢–ï–†–ú–ò–ù–û–õ–û–ì–ò–Ø

–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π - –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π—Å—è "—Å –æ–≥–ª—è–¥–∫–æ–π" –Ω–∞ –¥—Ä—É–≥–æ–π –∫–æ–¥, –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.
  –æ–±—ã—á–Ω–æ –∏–º–µ–µ—Ç—Å—è –≤ –≤–∏–¥—É –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ –∫–æ–¥–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ,  –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–ø–∏—Å–∞–Ω—ã.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π - –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞.
  –¢–∞–∫–æ–π –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –æ—Å–Ω–æ–≤–Ω—ã–º (–≤ –¥—Ä—É–≥–æ–º –ø–æ—Ç–æ–∫–µ) –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç "—Ä–∞–∑–≥—Ä—É–∑–∏—Ç—å" –æ—Å–≤–Ω–æ–Ω–æ–π –ø–æ—Ç–æ–∫ –∏ —É—Å–∫–æ—Ä–∏—Ç—å –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞
  –Ω–∞–ø—Ä–∏–º–µ—Ä, –∞—Ç—Ä–∏–±—É—Ç async –æ–∑–Ω–∞—á–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–∞ –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π (single-threaded) - –∑–∞–¥–µ–π—Å—Ç–≤—É—é—â–∏–π —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —è–¥—Ä–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.
  —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è.
  "can do 1 thing at a time" - –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –æ–¥–Ω—É –≤–µ—â—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  –û—Å–Ω–æ–≤–Ω–æ–π –¥–≤–∏–∂–æ–∫ Javascript ("runtime" - –Ω–∞–ø—Ä–∏–º–µ—Ä, V8) —Å–∞–º –ø–æ —Å–µ–±–µ –æ–¥–Ω–æ–ø–æ—Ç–æ—á–µ–Ω.
  –ü—Ä–∏–∑–Ω–∞–∫–æ–º —ç—Ç–æ–≥–æ —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Ç–æ–ª—å–∫–æ 1-–≥–æ call stack,
  –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ –Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

  –û–¥–Ω–∞–∫–æ, –µ—Å—Ç—å —Ç.–Ω. Web APIs - –ø–æ —Å—É—Ç–∏ –¥–µ–ª–∞ —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–µ –Ω–∞ JS,
  –Ω–æ –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ –∏ –º–æ–∂–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º –¥–≤–∏–∂–∫–æ–º JS (V8)
  WebAPI —è–≤–ª—è—é—Ç—Å—è DOM, SetTimeout, AJAX –∏ —Ç.–¥, –æ–Ω–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º, —Ç.–µ. –±—Ä–∞—É–∑–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∏–∂–æ–∫, —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ WebAPI –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å
  —Ç–∞–∫ —á—Ç–æ –≤—Å–µ API –¥–æ—Å—Ç—É–ø–Ω—ã –≤ JS –≤ –≤–∏–¥–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤.

  Node.JS —Ç–æ–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∏–∂–æ–∫ V8 + –≤–º–µ—Å—Ç–æ WebAPI C++ API(–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Å–∫—É - —á—Ç–µ–Ω–∏–µ / –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤ - —è–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º API)
  –ò –≤–æ—Ç –º–µ—Ç–æ–¥—ã —ç—Ç–∏—Ö API —è–≤–ª—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ.

  - –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ DOM –∏ –æ–Ω–∏ —Ç–æ–∂–µ –∂–∏–≤—É—Ç –≤ WEBAPI –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
  - setTimeout –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ call stack –±—É–¥–µ—Ç –∑–∞–Ω—è—Ç –∫ –º–æ–º–µ–Ω—Ç—É, –∫–æ–≥–¥–∞ –±—É–¥–∏–ª—å–Ω–∏–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–ª–ª–±—ç–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ–∑–∂–µ

  –ú—ã –Ω–µ –º–æ–∂–µ–º —Ç–æ—á–Ω–æ –∑–Ω–∞—Ç—å, –∫–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
  —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–µ—Ç–∏.
  –ò –Ω–µ—Ç —Å–ø–æ—Å–æ–±–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞, –∫–æ–≥–¥–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –∑–∞–∫–æ–Ω—á–∏—Ç —Ä–∞–±–æ—Ç—É.
  –ü–æ—ç—Ç–æ–º—É –µ—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∫–æ–≥–æ-—Ç–æ –∫–æ–¥–∞ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –º—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –∫–∞–∫ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –∫–æ–ª–ª–±—ç–∫,
  —á—Ç–æ–±—ã —ç—Ç–æ—Ç –∫–æ–¥ –º–æ–≥ –≤—ã–∑–≤–∞—Ç—å –Ω–∞—à –∫–æ–ª–ª–±—ç–∫, –∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç —Ä–∞–±–æ—Ç—É.

–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ - –æ–∂–∏–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∫–æ–π-–ª–∏–±–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ–º –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç—å –±–æ–ª—å—à–µ –Ω–∏–∫–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π, –æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è)
non-blocking.

// üïÆ <cyberbiont> 63c38f70-83bf-47fa-b527-c400762d742b.md
*/

/* –º—ã –Ω–µ —Ö–æ—Ç–∏–º –∂–¥–∞—Ç—å, –ø–æ–∫–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å, –æ—Ç–Ω–∏–º–∞—é—â–∏–π –≤—Ä–µ–º—è (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –æ–∂–∏–¥–∞–Ω–∏–µ 5—Å)
—Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–æ–¥–∞, –∞ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ö–æ—Ç–∏–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
–ø–µ—Ä–µ–¥–∞–µ–º –∫–∞–∫ –∫–æ–ª–ª–±—ç–∫, –∏ —á–µ—Ä–µ–∑ –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è –æ–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è */

// –∫–æ–ª–ª–±—ç–∫
function callbackExample() {
  console.log('Hi');
  // setTimeout —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –Ω–µ –∂–¥–µ—Ç –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é console.log('fem7')
  setTimeout(() => console.log('There'), 5000);
  // –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –ø–æ—Å–ª–µ –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –µ–≥–æ —Ä–∞–±–æ—Ç–∞ —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã –æ—Ç—Å—á–∏—Ç–∞—Ç—å 5 —Å) –º—ã –ø–µ—Ä–µ–¥–∞–µ–º –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é-–∫–æ–ª–ª–±—ç–∫ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –µ–µ –≤—ã–∑–æ–≤–µ—Ç, –∫–æ–≥–¥–∞ –∑–∞–∫–Ω—á–∏—Ç —Å—á–∏—Ç–∞—Ç—å
  console.log('fem7');
}
// callbackExample();

/* –ö–∞–∫ –∏–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ —Å–æ–æ–±—â–∏—Ç—å, –≤—Å–µ –ª–∏ –ø—Ä–æ—à–ª–æ —É–¥–∞—á–Ω–æ –∏–ª–∏ –∫–æ–¥ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π?
callback –æ–±—ã—á–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞, –ø–µ—Ä–≤—ã–π - –æ—à–∏–±–∫–∞ (–µ—Å–ª–∏ –æ–Ω–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞, –∏–Ω–∞—á–µ null)
–∏ –≤—Ç–æ—Ä–æ–π - —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
–ø–æ—Ç–æ–º –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–ª–±—ç–∫–∞ –º—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å –∫–∞–∫–∏–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –æ–Ω –±—ã–ª –≤—ã–∑–≤–∞–Ω –∏ —Å—Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –Ω–∞–¥–æ */

// —á—Ç–æ, –µ—Å–ª–∏ –Ω–∞—à –∫–æ–ª–ª–±—ç–∫ —Ç–æ–∂–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, –∏ –ø–æ—Å–ª–µ –Ω–µ–≥–æ —Ç–æ–∂–µ –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å –∫–∞–∫—É—é-—Ç–æ —Ä–∞–±–æ—Ç—É?

function callbackHellExample() {
  console.log('Hi');

  setTimeout(function callback() {
    console.log('1st setTimeout finished');

    setTimeout(function callback() {
      console.log('2nd setTimeout finished');

      setTimeout(function callback() {
        console.log('3rd setTimeout finished');
      }, 5000);
    }, 2000);
  }, 3000);
}
// callbackHellExample();
// üïÆ <cyberbiont> cd5eb9f5-bd0d-4f90-8be3-4c4ac85d3f75.md
// üïÆ <cyberbiont> 0454dfe9-e491-46d7-8692-aed634f61660.md

/* —á—Ç–æ–±—ã —Å —ç—Ç–∏–º –∫–∞–∫-—Ç–æ –±–æ—Ä–æ—Ç—å—Å—è, –ø—Ä–∏–¥—É–º–∞–ª–∏ –±–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∫–æ–¥–æ–º - Promises
Promise —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π ("—Å–æ–∑–¥–∞—é—â–∏–π") –∫–æ–¥ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π ("–ø–æ—Ç—Ä–µ–±–ª—è—é—â–∏–π")
–≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å–Ω–∞—Ä—É–∂–∏ –∏ –ø–æ—Ç–æ–º –≤—ã–∑—ã–≤–∞—Ç—å –µ–µ (callback),
–∞—Å–∏–Ω—Ö–æ–Ω–Ω—ã–π –∫–æ–¥ —Å–∞–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã—Å—Ç—É–ø–∞–µ—Ç "–ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–º":
—Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, —É –Ω–µ–≥–æ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–ª–ª–±—ç–∫, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω –æ—Ç–¥–∞–µ—Ç –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥,
–∞ —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –≤–Ω–µ—à–Ω–∏–π (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ) –∫–æ–¥ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∑–∞–∫–æ–Ω—á–∏–ª –ª–∏ —Ä–∞–±–æ—Ç—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ –ø–æ —Å—Ç–∞—Ç—É—Å—É –æ–±—ä–µ–∫—Ç–∞ (–ø—Ä–æ–º–∏—Å–∞)
*/
// üïÆ <cyberbiont> 9031e863-da72-45d6-9eed-fe026580650a.md

function basicExample() {
  const promise = new Promise(function (resolve, reject) {
    setTimeout(() => resolve('done!'), 1000);
  });

  // resolve –∑–∞–ø—É—Å—Ç–∏—Ç –ø–µ—Ä–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é, –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é –≤ .then
  // –≤—Ç–æ—Ä—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º then –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∏—Å–ø–æ–ª—å–∑—É—é—â—É—é—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ (–ü—Ä–æ–º–∏—Å –ø–æ–ª—É—á–∏–ª —Å–æ—Å—Ç–æ—è–Ω–∏–µ 'rejected')
  promise.then(
    (result) => console.log(result), // –≤—ã–≤–µ–¥–µ—Ç "done!" —á–µ—Ä–µ–∑ –æ–¥–Ω—É —Å–µ–∫—É–Ω–¥—É
    (error) => console.log(error), // –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω–∞
  );
}
// basicExample();

// –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã Promise (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–∞)
/* promise1 = {
  status: "Pending".
  result: undefined,
  resolve(resultValue) {
      this.status = "fullfiled"; // –≤—ã–ø–æ–ª–Ω–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
      this.result = resultValue;
  },
  reject(errMessage) {
      this.status = "rejected"; –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –æ—à–∏–±–∫–æ–π
      this.result = errMessage;
  }
}; */

function visaExample() {
  function getVisa(passport) {
    return new Promise(function (resolve, reject) {
      // —Ñ—É–Ω–∫—Ü–∏—è-–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (executor)
      // –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á—Ç–æ-—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, setTimeout
      const forbiddenNames = ['Rick', 'Morty'];

      setTimeout(function checkDocuments() {
        // –∂–¥–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        // –∫–æ–≥–¥–∞ –º—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –º—ã –¥–æ–ª–∂–Ω—ã –≤—ã–∑–≤–∞—Ç—å –∏–ª–∏ resolve, –∏–ª–∏ reject
        if (passport.isValid && !forbiddenNames.includes(passport.name))
          resolve({
            type: 'visa',
            name: passport.name,
          });
        else
          reject(
            new Error(
              'visa request rejected, your passport is not valid or your name is on the forbidden list',
            ),
          );
      }, 3000);
    });
  }

  getVisa({
    name: 'Joe',
    isValid: true,
  })
    .then((visa) => {
      // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–æ—Ç–æ–≤—É—é –≤–∏–∑—É –¥—Ä—É–∑—å—è–º
      console.log(visa);
      return visa;
    })
    /* –≤—ã–∑–æ–≤ then —Ç–æ–∂–µ (–Ω–µ—è–≤–Ω–æ) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å (—Å–º. –ø–æ–¥—Å–∫–∞–∑–∫—É Intellisense)
    - —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω—É–ª —Åallback —á–µ—Ä–µ–∑ return,
    –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–π, –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞, —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –æ—à–∏–±–∫–∏ */
    .then((visa) => {
      const money = 3000;
      // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —à–µ—Ñ—É –≤–∏–∑—É, –±–µ—Ä–µ–º –æ—Ç–ø—É—Å–∫ –Ω–∞ —Ä–∞–±–æ—Ç–µ –∏ –ø–æ–ª—É—á–∞–µ–º –æ—Ç–ø—É—Å–∫–Ω—ã–µ
      if (!visa) throw new Error('–≤–∞–º –Ω–µ –¥–∞–ª–∏ –æ—Ç–ø—É—Å–∫!');
      else return money;
    })
    // ... –±—Ä–æ–Ω–∏—Ä—É–µ–º –æ—Ç–µ–ª—å...
    .then((money) => {
      if (!money) throw new Error('–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ –±–∏–ª–µ—Ç—ã!');
      // –ø–æ–∫—É–ø–∞–µ–º –±–∏–ª–µ—Ç—ã
      const ticket = {
        type: 'ticket',
        timeToFlight: 2000,
      };
      return ticket;
    })
    .then((ticket) => {
      // –∂–¥–µ–º —Ä–µ–π—Å–∞
      // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ then –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –º–æ–∂–µ—Ç —è–≤–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–º–∏—Å,–µ—Å–ª–∏ –≤ –Ω–µ–º —á—Ç–æ-—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
      // setTimeout –ø—Ä–∏–Ω–∏–º–∞–µ—Ç callback, –Ω–æ –ø—Ä–æ–º–∏—Å —Å–∞–º–∞ –ø–æ —Å–µ–±–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç, –ø–æ—ç—Ç–æ–º—É –º—ã —ç—Ç–æ –¥–µ–ª–∞–µ–º —Å–∞–º–∏
      return new Promise((resolve, reject) =>
        setTimeout(() => {
          ticket.timeToFlight = 0;
          // confirm
          resolve(ticket);
        }, ticket.timeToFlight),
      );
    })
    .then((ticket) => {
      if (!ticket) throw new Error('–Ω–µ–ª—å–∑—è –ª–µ—Ç–µ—Ç—å –±–µ–∑ –±–∏–ª–µ—Ç–∞!');
      else console.log('–í—ã –≤ —Å–∞–º–æ–ª–µ—Ç–µ!');
      // –ª–µ—Ç–∏–º!
    })
    .catch((error) => {
      // –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
      // —Å—é–¥–∞ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –æ—à–∏–±–∫–∏ –∏–∑ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏, –≥–¥–µ –±—ã –æ—à–∏–±–∫–∞ –Ω–µ –≤–æ–∑–Ω–∏–∫–ª–∞
      console.log(error);
    })
    .finally(() => {
      // –∑–∞–ø–æ—Å—Ç–∏—Ç—å –≤ —Ñ–µ–π—Å–±—É–∫ –∏—Å—Ç–æ—Ä–∏—é –∫–∞–∫ –≤—ã –ø—ã—Ç–∞–ª–∏—Å—å —Å–ª–µ—Ç–∞—Ç—å –≤ –æ—Ç–ø—É—Å–∫
    });

  /* getVisa({
    name: 'Joe',
    isValid: true,
  })
    .then(getMoney)
    .then(buyTicket)
    .then(fly);

  function getMoney(visa) {
    if (visa) return 1000;
    else throw new Error('–≤–∞–º –Ω–µ –¥–∞–ª–∏ –æ—Ç–ø—É—Å–∫!');
  }

  function buyTicket(money) {
    if (money >= 1000) return 'ticket';
    else throw new Error('–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ –±–∏–ª–µ—Ç—ã!');
  }

  function fly(ticket) {
    if (ticket) console.log('–í—ã –≤ —Å–∞–º–æ–ª–µ—Ç–µ!');
    else throw new Error('–Ω–µ–ª—å–∑—è –ª–µ—Ç–µ—Ç—å –±–µ–∑ –±–∏–ª–µ—Ç–∞!');
  } */
}
// visaExample();

/* PROMISE API */
/* Promise.all, Promise.allSettled, Promise.race, Promise.resolve, Promise.reject */

/* Promise.all */
// –∏–º–µ–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–¥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å –∫–∞–∂–¥—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –º–∞—Å—Å–∏–≤–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
const arr = [
  { name: 'a', time: 2000 },
  { name: 'b', time: 1000 },
  { name: 'c', time: 3000 },
];
const results = Promise.all(
  arr.map((elem) => {
    return new Promise((res) => setTimeout(() => res(elem.name), elem.time));
  }),
).then((result) => console.log(result));

/* Promise.race –≤–µ—Ä–Ω–µ—Ç —Ç–æ–ª—å–∫–æ 'b', —Ç.–∫. —Ç–æ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø–µ—Ä–≤—ã–º */
console.log(results); // pending

/* Promise.resolve
–∏–º–µ–µ—Ç —Å–º—ã—Å–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è "–æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è" —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –ø—Ä–æ–º–∏—Å,
—á—Ç–æ–±—ã —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
{
  const cache = new Map();

  // —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–æ–º–∏—Å –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ, –º—ã —Ö–æ—Ç–∏–º –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –º–æ–∂–µ–º –ø—Ä–∏–µ—Ä–ø–∏—Ç—å .then –∫ –µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
  function loadCached(url) {
    // –Ω–æ –≤–µ—Ä–æ—è—Ç–µ–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π –∫–æ–≥–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é, –∞ –Ω–µ –≤ –≤–∏–¥–µ –ø—Ä–æ–º–∏—Å–∞
    // —Ç–æ–≥–¥–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ –ø—Ä–æ–º–∏—Å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
    if (cache.has(url)) {
      return Promise.resolve(cache.get(url)); // (*)
    }

    return fetch(url)
      .then((response) => response.text())
      .then((text) => {
        cache.set(url, text);
        return text;
      });
  }

  // loadCached.then((result) => console.log(result));
}
